"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _input=_interopRequireDefault(require("../../input/src/input")),_conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function findOffsetOption(e,t,i){for(var n,o,l=!1,s=0;s<e.length;s++){var a=e[s];if(a.options)for(var r=0;r<a.options.length;r++){var u=a.options[r];if(o||(o=u),i){if(t===u.value)return{offsetOption:n,firstOption:o}}else{if(l)return{offsetOption:u,firstOption:o};t===u.value&&(l=!0)}n=u}else{if(o||(o=a),i){if(t===a.value)return{offsetOption:n,firstOption:o}}else{if(l)return{offsetOption:a,firstOption:o};t===a.value&&(l=!0)}n=a}}return{firstOption:o}}function findOption(e,t){for(var i=0;i<e.length;i++){var n=e[i];if(n.options)for(var o=0;o<n.options.length;o++){var l=n.options[o];if(t===l.value)return l}else if(t===n.value)return n}}function renderOption(i,e,t){var n=e.optionProps,o=void 0===n?{}:n,l=o.label||"label",s=o.value||"value",a=o.disabled||"disabled";return t?t.map(function(e,t){return i("vxe-option",{key:t,props:{label:e[l],value:e[s],disabled:e[a]}})}):[]}function renderOptgroup(i,n){var e=n.optionGroups,t=n.optionGroupProps,o=void 0===t?{}:t,l=o.options||"options",s=o.label||"label";return e?e.map(function(e,t){return i("vxe-optgroup",{key:t,props:{label:e[s]}},renderOption(i,n,e[l]))}):[]}var _default2={name:"VxeSelect",props:{value:null,clearable:Boolean,placeholder:String,disabled:Boolean,prefixIcon:String,placement:String,options:Array,optionProps:Object,optionGroups:Array,optionGroupProps:Object,size:String,transfer:{type:Boolean,default:function(){return _conf.default.select.transfer}}},components:{VxeInput:_input.default},provide:function(){return{$xeselect:this}},data:function(){return{updateFlag:0,panelIndex:0,optionList:[],allOptList:[],panelStyle:null,panelPlacement:null,currentValue:null,visiblePanel:!1,animatVisible:!1,isActivated:!1}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize},selectLabel:function(){var e=findOption(this.allOptList,this.value);return e?e.label:""}},watch:{updateFlag:function(){this.updateOptComps()}},created:function(){_tools.GlobalEvent.on(this,"mousedown",this.handleGlobalMousedownEvent),_tools.GlobalEvent.on(this,"keydown",this.handleGlobalKeydownEvent),_tools.GlobalEvent.on(this,"mousewheel",this.handleGlobalMousewheelEvent),_tools.GlobalEvent.on(this,"blur",this.handleGlobalBlurEvent)},mounted:function(){this.transfer&&document.body.appendChild(this.$refs.panel)},beforeDestroy:function(){var e=this.$refs.panel;e&&e.parentNode&&e.parentNode.removeChild(e)},destroyed:function(){_tools.GlobalEvent.off(this,"mousedown"),_tools.GlobalEvent.off(this,"keydown"),_tools.GlobalEvent.off(this,"mousewheel"),_tools.GlobalEvent.off(this,"blur")},render:function(e){var t,i,n=this.vSize,o=this.transfer,l=this.isActivated,s=this.disabled,a=this.clearable,r=this.placeholder,u=this.selectLabel,p=this.animatVisible,d=this.visiblePanel,f=this.panelStyle,h=this.prefixIcon,c=this.panelPlacement,v=this.optionGroups;return e("div",{class:["vxe-select",(t={},_defineProperty(t,"size--".concat(n),n),_defineProperty(t,"is--visivle",d),_defineProperty(t,"is--disabled",s),_defineProperty(t,"is--active",l),t)]},[e("vxe-input",{ref:"input",props:{clearable:a,placeholder:r,readonly:!0,disabled:s,type:"text",prefixIcon:h,suffixIcon:d?_conf.default.icon.selectOpen:_conf.default.icon.selectClose,value:u},on:{clear:this.clearEvent,click:this.togglePanelEvent,focus:this.focusEvent,"suffix-click":this.togglePanelEvent}}),e("div",{ref:"panel",class:["vxe-dropdown--panel vxe-select--panel",(i={},_defineProperty(i,"size--".concat(n),n),_defineProperty(i,"is--transfer",o),_defineProperty(i,"animat--leave",p),_defineProperty(i,"animat--enter",d),i)],attrs:{"data-placement":c},style:f},[e("div",{class:"vxe-select-option--wrapper"},this.$slots.default||(v?renderOptgroup(e,this):renderOption(e,this,this.options)))])])},methods:{updateOptions:function(){this.updateFlag++},updateOptComps:function(){var e=this;return this.$nextTick().then(function(){var o=[],l=[];e.$children.forEach(function(e){if(e.$xeselect){var t=[],i=[],n=e.$children.length;e.$children.forEach(function(e){e.$xeselect&&e.$xeoptgroup&&(e.isDisabled||t.push({label:e.label,value:e.value,disabled:e.isDisabled,id:e.id}),i.push({label:e.label,value:e.value,disabled:e.isDisabled,id:e.id}))}),n?(t.length&&o.push({label:e.label,disabled:e.disabled,options:t}),i.length&&l.push({label:e.label,disabled:e.disabled,options:i})):(e.disabled||o.push({label:e.label,value:e.value,disabled:e.disabled,id:e.id}),l.push({label:e.label,value:e.value,disabled:e.disabled,id:e.id}))}}),e.optionList=o,e.allOptList=l})},setCurrentOption:function(e){var t=this;e&&(this.currentValue=e.value,this.$nextTick(function(){_tools.DomTools.toView(t.$refs.panel.querySelector("[data-option-id='".concat(e.id,"']")))}))},clearEvent:function(e,t){this.clearValueEvent(t,null),this.hideOptionPanel()},clearValueEvent:function(e,t){this.changeEvent(e,t),this.$emit("clear",{value:t,$event:e},e)},changeEvent:function(e,t){t!==this.value&&(this.$emit("input",t),this.$emit("change",{value:t,$event:e},e))},changeOptionEvent:function(e,t){this.changeEvent(e,t),this.hideOptionPanel()},handleGlobalMousedownEvent:function(e){var t=this.$refs,i=this.$el,n=this.disabled,o=this.visiblePanel;n||(this.isActivated=_tools.DomTools.getEventTargetNode(e,i).flag||_tools.DomTools.getEventTargetNode(e,t.panel).flag,o&&!this.isActivated&&this.hideOptionPanel())},handleGlobalKeydownEvent:function(e){var t=this.visiblePanel,i=this.currentValue,n=this.clearable;if(!this.disabled){var o=e.keyCode,l=9===o,s=13===o,a=27===o,r=38===o,u=40===o,p=46===o;if(l&&(this.isActivated=!1),t){if(a||l)this.hideOptionPanel();else if(s)this.changeOptionEvent(e,i);else if(r||u){e.preventDefault();var d=this.optionList,f=findOffsetOption(d,i,r),h=f.offsetOption,c=f.firstOption;h||findOption(d,i)||(h=c),this.setCurrentOption(h)}}else s&&this.isActivated&&this.showOptionPanel();p&&n&&this.isActivated&&this.clearValueEvent(e,null)}},handleGlobalMousewheelEvent:function(e){_tools.DomTools.getEventTargetNode(e,this.$el).flag||_tools.DomTools.getEventTargetNode(e,this.$refs.panel).flag||this.hideOptionPanel()},handleGlobalBlurEvent:function(){this.hideOptionPanel()},updateZindex:function(){this.panelIndex<_tools.UtilTools.getLastZIndex()&&(this.panelIndex=_tools.UtilTools.nextZIndex())},focusEvent:function(){this.disabled||(this.isActivated=!0)},togglePanelEvent:function(e,t){t.preventDefault(),this.visiblePanel?this.hideOptionPanel():this.showOptionPanel()},showOptionPanel:function(){var e=this;this.disabled||(clearTimeout(this.hidePanelTimeout),this.isActivated=!0,this.animatVisible=!0,setTimeout(function(){e.visiblePanel=!0,e.setCurrentOption(findOption(e.allOptList,e.value))},10),this.updateZindex(),this.updatePlacement())},hideOptionPanel:function(){var e=this;this.visiblePanel=!1,this.hidePanelTimeout=setTimeout(function(){e.animatVisible=!1},200)},updatePlacement:function(){var O=this;this.$nextTick(function(){var e=O.$refs,t=O.transfer,i=O.placement,n=O.panelIndex,o=e.input.$el,l=e.panel,s=o.offsetHeight,a=o.offsetWidth,r=l.offsetHeight,u={zIndex:n},p=_tools.DomTools.getAbsolutePos(o),d=p.boundingTop,f=p.boundingLeft,h=p.visibleHeight,c="bottom";if(t){var v=f,b=d+s;"top"===i?(c="top",b=d-r):(h<b+r&&(c="top",b=d-r),b<0&&(c="bottom",b=d+s)),Object.assign(u,{left:"".concat(v,"px"),top:"".concat(b,"px"),minWidth:"".concat(a,"px")})}else"top"===i?(c="top",u.bottom="".concat(s,"px")):h<d+s+r&&(c="top",u.bottom="".concat(s,"px"));O.panelStyle=u,O.panelPlacement=c})},focus:function(){return this.showOptionPanel(),this.$nextTick()},blur:function(){return this.hideOptionPanel(),this.$nextTick()}}};exports.default=_default2;