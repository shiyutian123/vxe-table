"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _conf=_interopRequireDefault(require("../../conf")),_modal=_interopRequireDefault(require("../../modal/src/modal")),_input=_interopRequireDefault(require("../../input/src/input")),_checkbox=_interopRequireDefault(require("../../checkbox/src/checkbox")),_select=_interopRequireDefault(require("../../select/src/select")),_option=_interopRequireDefault(require("../../select/src/option"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default={name:"VxeExportPanel",props:{defaultOptions:Object,storeData:Object},components:{VxeModal:_modal.default,VxeInput:_input.default,VxeCheckbox:_checkbox.default,VxeSelect:_select.default,VxeOption:_option.default},data:function(){return{isAll:!1,isIndeterminate:!1,loading:!1}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize},showSheet:function(){return-1<["html","xml","xlsx"].indexOf(this.defaultOptions.type)}},render:function(o){var n=this,e=this._e,t=this.isAll,i=this.isIndeterminate,l=this.showSheet,c=this.defaultOptions,a=this.storeData;return o("vxe-modal",{res:"modal",model:{value:a.visible,callback:function(e){a.visible=e}},props:{title:_conf.default.i18n("vxe.export.expTitle"),width:660,mask:!0,lockView:!0,showFooter:!1,escClosable:!0,maskClosable:!0,loading:this.loading},on:{show:this.showEvent}},[o("div",{class:"vxe-export--panel"},[o("table",{attrs:{cellspacing:0,cellpadding:0,border:0}},[o("tbody",[[o("tr",[o("td",_conf.default.i18n("vxe.export.expName")),o("td",[o("vxe-input",{ref:"filename",model:{value:c.filename,callback:function(e){c.filename=e}},props:{type:"text",clearable:!0,placeholder:_conf.default.i18n("vxe.export.expNamePlaceholder")}})])]),o("tr",[o("td",_conf.default.i18n("vxe.export.expType")),o("td",[o("vxe-select",{model:{value:c.type,callback:function(e){c.type=e}}},a.typeList.map(function(e){return o("vxe-option",{props:{value:e.value,label:_conf.default.i18n(e.label)}})}))])]),l?o("tr",[o("td",_conf.default.i18n("vxe.export.expSheetName")),o("td",[o("vxe-input",{model:{value:c.sheetName,callback:function(e){c.sheetName=e}},props:{type:"text",clearable:!0,placeholder:_conf.default.i18n("vxe.export.expSheetNamePlaceholder")}})])]):e(),o("tr",[o("td",_conf.default.i18n("vxe.export.expMode")),o("td",[o("vxe-select",{model:{value:c.mode,callback:function(e){c.mode=e}}},a.modeList.map(function(e){return o("vxe-option",{props:{value:e.value,label:_conf.default.i18n(e.label)}})}))])]),o("tr",[o("td",[_conf.default.i18n("vxe.export.expColumn")]),o("td",[o("div",{class:"vxe-export--panel-column"},[o("ul",{class:"vxe-export--panel-column-header"},[o("li",{class:["vxe-export--panel-column-option",{"is--checked":t,"is--indeterminate":i}],attrs:{title:_conf.default.i18n("vxe.table.allTitle")},on:{click:this.allColumnEvent}},[o("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),o("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),o("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"}),o("span",{class:"vxe-checkbox--label"},_conf.default.i18n("vxe.export.expCurrentColumn"))])]),o("ul",{class:"vxe-export--panel-column-body"},a.columns.map(function(e){var t=e.getTitle();return o("li",{class:["vxe-export--panel-column-option",{"is--checked":e.checked,"is--disabled":e.disabled}],attrs:{title:t},on:{click:function(){e.disabled||(e.checked=!e.checked,n.checkStatus())}}},[o("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),o("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),o("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"}),o("span",{class:"vxe-checkbox--label"},t)])}))])])]),o("tr",[o("td",_conf.default.i18n("vxe.export.expOpts")),o("td",[o("vxe-checkbox",{model:{value:c.isHeader,callback:function(e){c.isHeader=e}},props:{title:_conf.default.i18n("vxe.export.expHeaderTitle")}},_conf.default.i18n("vxe.export.expOptHeader")),o("vxe-checkbox",{model:{value:c.isFooter,callback:function(e){c.isFooter=e}},props:{disabled:!a.hasFooter,title:_conf.default.i18n("vxe.export.expFooterTitle")}},_conf.default.i18n("vxe.export.expOptFooter")),o("vxe-checkbox",{model:{value:c.original,callback:function(e){c.original=e}},props:{title:_conf.default.i18n("vxe.export.expOriginalTitle")}},_conf.default.i18n("vxe.export.expOptOriginal"))])])]])]),o("div",{class:"vxe-export--panel-btns"},[c.isPrint?o("vxe-button",{on:{click:this.printEvent}},_conf.default.i18n("vxe.export.expPrint")):null,o("vxe-button",{props:{status:"primary"},on:{click:this.exportEvent}},_conf.default.i18n("vxe.export.expConfirm"))])])])},methods:{checkStatus:function(){var e=this.storeData.columns;this.isAll=e.every(function(e){return e.disabled||e.checked}),this.isIndeterminate=!this.isAll&&e.some(function(e){return!e.disabled&&e.checked})},allColumnEvent:function(){var t=!this.isAll;this.storeData.columns.forEach(function(e){e.disabled||(e.checked=t)}),this.isAll=t,this.checkStatus()},showEvent:function(){var e=this;this.$nextTick(function(){e.$refs.filename.focus()}),this.checkStatus()},getExportOption:function(){var e=this.storeData,t=this.defaultOptions;return Object.assign({columns:e.columns.filter(function(e){return e.checked})},t)},printEvent:function(){var e=this.$parent;this.storeData.visible=!1,e.print(Object.assign({},e.printOpts,this.getExportOption()))},exportEvent:function(){var e=this,t=this.$parent;this.loading=!0,t.exportData(Object.assign({},t.exportOpts,this.getExportOption())).then(function(){e.loading=!1,e.storeData.visible=!1})}}};exports.default=_default;