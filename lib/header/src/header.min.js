"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}var getAllColumns=function t(e){var r=[];return e.forEach(function(e){e.visible&&(e.children&&e.children.length&&e.children.some(function(e){return e.visible})?(r.push(e),r.push.apply(r,_toConsumableArray(t(e.children)))):r.push(e))}),r},convertToRows=function(e){var l=1;e.forEach(function(e){e.level=1,function t(r,e){if(e&&(r.level=e.level+1,l<r.level&&(l=r.level)),r.children&&r.children.length&&r.children.some(function(e){return e.visible})){var o=0;r.children.forEach(function(e){e.visible&&(t(e,r),o+=e.colSpan)}),r.colSpan=o}else r.colSpan=1}(e)});for(var t=[],r=0;r<l;r++)t.push([]);return getAllColumns(e).forEach(function(e){e.children&&e.children.length&&e.children.some(function(e){return e.visible})?e.rowSpan=1:e.rowSpan=l-e.level+1,t[e.level-1].push(e)}),t},_default={name:"VxeTableHeader",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},data:function(){return{headerColumn:[]}},watch:{tableColumn:function(){this.uploadColumn()}},created:function(){this.uploadColumn()},mounted:function(){var e=this.$parent,t=this.$el,r=this.$refs,o=this.fixedType,l=e.elemStore,n="".concat(o||"main","-header-");l["".concat(n,"wrapper")]=t,l["".concat(n,"table")]=r.table,l["".concat(n,"colgroup")]=r.colgroup,l["".concat(n,"list")]=r.thead,l["".concat(n,"xSpace")]=r.xSpace,l["".concat(n,"repair")]=r.repair},render:function(C){var w=this,e=this._e,T=this.$parent,A=this.fixedType,t=this.headerColumn,r=this.fixedColumn,o=this.tableColumn,S=T.$listeners,l=T.id,$=T.resizable,z=T.border,P=T.columnKey,n=T.headerRowClassName,k=T.headerCellClassName,i=T.headerRowStyle,I=T.headerCellStyle,W=T.showHeaderOverflow,D=T.headerAlign,E=T.align,R=T.highlightCurrentColumn,H=T.currentColumn,a=T.mouseConfig,s=T.mouseOpts,L=T.scrollXLoad,M=T.overflowX,c=T.scrollbarWidth,O=T.getColumnIndex,U=T.sortOpts,j=a&&s.selected,q=a&&(s.range||s.checked);return L&&A&&(o=r),C("div",{class:["vxe-table--header-wrapper",A?"fixed-".concat(A,"--wrapper"):"body--wrapper"],attrs:{"data-tid":l}},[A?e():C("div",{class:"vxe-body--x-space",ref:"xSpace"}),C("table",{class:"vxe-table--header",attrs:{"data-tid":l,cellspacing:0,cellpadding:0,border:0},ref:"table"},[C("colgroup",{ref:"colgroup"},o.map(function(e,t){var r=e.children&&e.children.length;return C("col",{attrs:{name:e.id},key:P||r?e.id:t})}).concat(c?[C("col",{attrs:{name:"col_gutter"}})]:[])),C("thead",{ref:"thead"},t.map(function(_,x){return C("tr",{class:["vxe-header--row",n?_xeUtils.default.isFunction(n)?n({$table:T,$rowIndex:x,fixed:A}):n:""],style:i?_xeUtils.default.isFunction(i)?i({$table:T,$rowIndex:x,fixed:A}):i:null},_.map(function(e,t){var r,o=e.showHeaderOverflow,l=e.headerAlign,n=e.align,i=e.headerClassName,a=e.children&&e.children.length,s=A?e.fixed!==A&&!a:e.fixed&&M,c=_xeUtils.default.isUndefined(o)||_xeUtils.default.isNull(o)?W:o,d=l||n||D||E,u="ellipsis"===c,f="title"===c,h=!0===c||"tooltip"===c,p=f||h||u,m={},y=e.filters&&e.filters.some(function(e){return e.checked}),v=O(e),b={$table:T,$rowIndex:x,column:e,columnIndex:v,$columnIndex:t,fixed:A,isHidden:s,hasFilter:y};L&&!p&&(u=p=!0),(f||h)&&(m.mouseenter=function(e){T._isResize||(f?_tools.DomTools.updateCellTitle(e):h&&T.triggerHeaderTooltipEvent(e,b))}),h&&(m.mouseleave=function(e){T._isResize||h&&T.handleTargetLeaveEvent(e)}),(R||S["header-cell-click"]||q||"cell"===U.trigger)&&(m.click=function(e){return T.triggerHeaderCellClickEvent(e,b)}),S["header-cell-dblclick"]&&(m.dblclick=function(e){return T.triggerHeaderCellDBLClickEvent(e,b)}),(j||q)&&(m.mousedown=function(e){return T.triggerHeaderCellMousedownEvent(e,b)});var g="seq"===e.type||"index"===e.type?"seq":e.type;return C("th",{class:["vxe-header--column",e.id,(r={},_defineProperty(r,"col--".concat(d),d),_defineProperty(r,"col--".concat(g),g),_defineProperty(r,"col--last",t===_.length-1),_defineProperty(r,"col--fixed",e.fixed),_defineProperty(r,"col--group",a),_defineProperty(r,"col--ellipsis",p),_defineProperty(r,"fixed--hidden",s),_defineProperty(r,"is--sortable",e.sortable),_defineProperty(r,"is--filter",!!e.filters),_defineProperty(r,"filter--active",y),_defineProperty(r,"col--current",H===e),r),_tools.UtilTools.getClass(i,b),_tools.UtilTools.getClass(k,b)],attrs:{"data-colid":e.id,colspan:e.colSpan,rowspan:e.rowSpan},style:I?_xeUtils.default.isFunction(I)?I(b):I:null,on:m,key:P||a?e.id:v},[C("div",{class:["vxe-cell",{"c--title":f,"c--tooltip":h,"c--ellipsis":u}]},e.renderHeader(C,b)),!s&&!a&&(_xeUtils.default.isBoolean(e.resizable)?e.resizable:$)?C("div",{class:["vxe-resizable",{"is--line":!z||"none"===z}],on:{mousedown:function(e){return w.resizeMousedown(e,b)}}}):null])}).concat(c?[C("th",{class:"col--gutter"})]:[]))}))]),C("div",{class:"vxe-table--header-border-line",ref:"repair"})])},methods:{uploadColumn:function(){this.headerColumn=this.isGroup?convertToRows(this.collectColumn):[this.$parent.scrollXLoad&&this.fixedType?this.fixedColumn:this.tableColumn]},resizeMousedown:function(e,t){var r=t.column,o=this.$parent,l=this.$el,n=this.fixedType,i=o.$refs,a=i.tableBody,s=i.leftContainer,c=i.rightContainer,d=i.resizeBar,u=e.target,f=e.clientX,h=u.parentNode,p=0,m=a.$el,y=_tools.DomTools.getOffsetPos(u,l),v=u.clientWidth,b=Math.floor(v/2),g=r.getMinWidth()-b,_=y.left-h.clientWidth+v+g,x=y.left+b,C=document.onmousemove,w=document.onmouseup,T="left"===n,A="right"===n,S=0;if(T||A){for(var $=T?"nextElementSibling":"previousElementSibling",z=h[$];z&&!_tools.DomTools.hasClass(z,"fixed--hidden");)_tools.DomTools.hasClass(z,"col--group")||(S+=z.offsetWidth),z=z[$];A&&c&&(x=c.offsetLeft+S)}var P=function(e){e.stopPropagation(),e.preventDefault();var t=e.clientX-f,r=x+t,o=n?0:m.scrollLeft;T?r=Math.min(r,(c?c.offsetLeft:m.clientWidth)-S-g):A&&(_=(s?s.clientWidth:0)+S+g,r=Math.min(r,x+h.clientWidth-g)),p=Math.max(r,_),d.style.left="".concat(p-o,"px")};o._isResize=!0,_tools.DomTools.addClass(o.$el,"c--resize"),d.style.display="block",document.onmousemove=P,document.onmouseup=function(){document.onmousemove=C,document.onmouseup=w,r.resizeWidth=r.renderWidth+(A?x-p:p-x),d.style.display="none",o._isResize=!1,o._lastResizeTime=Date.now(),o.analyColumnWidth(),o.recalculate(!0),_tools.DomTools.removeClass(o.$el,"c--resize"),o.$toolbar&&o.$toolbar.updateResizable(),o.$emit("resizable-change",Object.assign({$event:e},t))},P(e)}}};exports.default=_default;